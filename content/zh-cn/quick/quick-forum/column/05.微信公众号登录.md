05.微信公众号登录.md
---


本地开发测试demo

获取微信公众号返回

```bash
curl -X POST 'http://localhost:8080/wx/callback' -H 'content-type:application/xml' -d '<xml><URL><![CDATA[https://hhui.top]]></URL><ToUserName><![CDATA[一灰灰blog]]></ToUserName><FromUserName><![CDATA[demoUser1234]]></FromUserName><CreateTime>1655700579</CreateTime><MsgType><![CDATA[text]]></MsgType><Content><![CDATA[login]]></Content><MsgId>11111111</MsgId></xml>' -i
```


测试登录

```bash

curl 'http://localhost:8080/login?code=771755' -i
```

SELECT data.day, IFNULL(data.count, 0), day_list.day as date from 
	// 下面这个则是统计sql，将其余日期表进行关联
	(select DATE_FORMAT(create_time, '%Y-%m-%d') day, count(id) count from u1 GROUP BY day) data
right join 
	// 下面这个主要是构建一个日期表day_list, 只有一个成员 day, 取值为今天，昨天，前天，一直往前; 要求 u1 这个表的数据超过30条
	(SELECT @date := DATE_ADD(@date, interval 1 day) day from  (SELECT @date := DATE_ADD(CURDATE(), interval - 1 day) from u1) days limit 30) day_list 
on day_list.day = data.day



select * from (select @num:=@num+1, date_format(adddate('2018-03-11', INTERVAL @num DAY),'%Y-%m-%d') as date
from user_attendance, (select @num:=0) t where adddate('2018-03-11', INTERVAL @num DAY) <= date_format('2018-03-15','%Y-%m-%d')
order by date
)a



```
select l.today, l.total_cnt, r.owl_cnt from 
(select date_format(create_at, '%Y-%m-%d') today, count(*) as total_cnt from zd_user_info where create_at > '2022-08-01' group by today) l
left join 
(select date_format(create_at, '%Y-%m-%d') today, count(*) as owl_cnt from zd_user_info where uuid like 'owl-%' and create_at > '2022-08-01' group by today) r
on l.today = r.today 
```


```
select z.sync_date, count(distinct z.uuid) from zd_user_read_time as z left join zd_user_info as u on z.uuid = u.id where u.uuid like 'owl-%' and sync_date > '2022-08-01' group by sync_date
```


